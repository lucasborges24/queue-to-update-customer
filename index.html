<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Escala de Atualização de Clientes</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: #121a2b;
      --muted: #7a8aa0;
      --text: #eaf0ff;
      --accent: #6ea8ff;
      --ok: #3ddc97;
      --warn: #ffcc66;
      --err: #ff7a7a;
      --border: #1f2a44;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #08101f 0%, #0b1326 100%); color: var(--text);
      min-height: 100vh; display: grid; place-items: start center; padding: 24px;
    }
    .app {
      width: 100%; max-width: 950px; background: var(--card); border: 1px solid var(--border);
      border-radius: 16px; padding: 20px 20px 28px; box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
    header h1 { font-size: 20px; margin: 0; letter-spacing: .2px; }
    header .tag { font-size: 12px; color: var(--muted); background: #0e1727; padding: 4px 8px; border-radius: 999px; border: 1px solid var(--border); }
    .row { display: grid; grid-template-columns: 1fr 1fr auto; gap: 12px; margin-top: 12px; }
    label { font-size: 12px; color: var(--muted); display: block; margin-bottom: 6px; }
    select, input[type="number"] {
      width: 100%; background: #0c1425; color: var(--text); border: 1px solid var(--border);
      padding: 10px 12px; border-radius: 10px; outline: none;
    }
    /* Melhorias para input number: esconder spinner em WebKit/Chrome e Firefox, foco mais visível */
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none; margin: 0;
    }
  input[type="number"] { -moz-appearance: textfield; appearance: textfield; }
    input[type="number"]:focus { box-shadow: 0 6px 18px rgba(14,23,39,.35); border-color: var(--accent); }
    .btn {
      background: var(--accent); color: #031129; border: none; padding: 12px 16px; border-radius: 10px;
      cursor: pointer; font-weight: 600; letter-spacing: .2px; align-self: end;
      transition: transform .12s ease, box-shadow .12s ease, background-color .12s ease;
    }
    .btn.secondary { background: #162038; color: var(--text); border: 1px solid var(--border); }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(14,23,39,.45); }
    .btn.secondary:hover { background: #1b2638; }
    .btn:active { transform: translateY(0); }
    .hint {
      margin-top: 10px; font-size: 13px; color: var(--muted);
    }
    .caps {
      display: flex; gap: 16px; margin-top: 14px; font-size: 13px;
    }
  .caps span { padding: 6px 10px; border: 1px solid var(--border); border-radius: 8px; background: #0e1727; }
  select, button, summary { cursor: pointer; }
    .msg { margin-top: 12px; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); }
    .msg.ok { background: #0f1e19; color: var(--ok); }
    .msg.warn { background: #221d0f; color: var(--warn); }
    .msg.err { background: #2a1414; color: var(--err); }
    details {
      margin-top: 10px; background: #0e1727; border: 1px solid var(--border); border-radius: 10px; padding: 8px 10px;
    }
    details summary { cursor: pointer; color: var(--muted); font-size: 13px; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 16px; border: 1px solid var(--border);
      border-radius: 12px; overflow: hidden;
    }
    thead th {
      text-align: left; font-size: 12px; color: var(--muted); background: #0b152b; padding: 10px; border-bottom: 1px solid var(--border);
    }
    tbody td {
      padding: 10px; border-bottom: 1px solid var(--border);
      transition: background-color .12s ease, color .12s ease;
    }
    tbody tr:last-child td { border-bottom: none; }
    tbody tr:hover td { background: rgba(110,168,255,0.04); }
    .pill {
      padding: 3px 8px; border-radius: 999px; font-size: 12px; display: inline-block;
      background: #13223f; border: 1px solid var(--border);
    }
    .footer {
      margin-top: 18px; display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;
    }
    .right { display: flex; gap: 8px; }
    .small { font-size: 12px; color: var(--muted); }
    .muted { color: var(--muted); }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 720px) {
      .row { grid-template-columns: 1fr; }
      .grid2 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Escala de Atualização de Clientes</h1>
      <span class="tag">prioridade + sorteio + limite 2 por colaborador</span>
      <nav style="margin-left:auto; display:flex; gap:8px; align-items:center;">
        <a href="weekly.html" style="color:var(--muted); text-decoration:none; font-size:13px;">Prioridades da semana</a>
      </nav>
    </header>

    <div class="row">
      <div>
        <label for="dia">Dia</label>
        <select id="dia" aria-label="Selecione o dia"></select>
      </div>
      <div>
        <label for="qtd">Qtde de clientes a atualizar</label>
        <input id="qtd" type="number" min="1" step="1" value="2" />
      </div>
      <button id="gerar" class="btn">Gerar atribuição</button>
    </div>

    <div class="caps" id="caps"></div>
    <div id="alerta"></div>

    <details id="det">
      <summary>Ver prioridades do dia</summary>
      <div id="prior-list" class="grid2" style="margin-top:10px;"></div>
    </details>

    <table id="tabela" style="display:none;">
      <thead>
        <tr>
          <th>#</th>
          <th>Colaborador</th>
          <th>Prioridade</th>
          <th>Carga do dia (após atribuição)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="footer">
      <div class="small">Dica: cada clique em “Gerar atribuição” refaz o sorteio (desempates aleatórios).</div>
      <div class="right">
        <button id="limpar" class="btn secondary">Limpar</button>
        <button id="copiar" class="btn secondary">Copiar resultado</button>
      </div>
    </div>
  </div>

  <script>
    "use strict";

    // ======= DADOS – edite aqui se precisar mudar a escala =======
    // Use as chaves "dom", "seg", "ter", "quar", "qui" como no seu pedido.
    const PRIORIDADES = {
      dom: [
        { name: "Yan Lucas",    p: 5 },
        { name: "Lucas Solerne",  p: 5 },
        { name: "Pedro",  p: 3 },
        { name: "Anthony",    p: 2 },
        { name: "Cadu",   p: 1 },
      ],
      seg: [
        { name: "Cadu",   p: 5 },
        { name: "Anthony",    p: 5 },
        { name: "Lucas Solerne",  p: 5 },
        { name: "Yan Lucas",    p: 4 },
        { name: "Pedro",  p: 3 },
        { name: "Marcos", p: 3 }, // "marcos3" → marcos com prioridade 3
      ],
      ter: [
        { name: "Pedro",  p: 5 },
        { name: "Paulo",  p: 5 },
        { name: "Cadu",   p: 5 },
        { name: "Lucas Solerne",  p: 5 },
        { name: "Anthony",    p: 5 },
        { name: "Marcos", p: 4 }, // "marcos4"
        { name: "Yan Lucas",    p: 3 },
        { name: "Jerfeson",   p: 1 },
        { name: "Natasha",  p: 1 },
      ],
      quar: [
        { name: "Pedro",  p: 5 },
        { name: "Anthony",    p: 5 },
        { name: "Lucas Solerne",  p: 4 },
        { name: "Yan Lucas",    p: 3 },
        { name: "Marcos", p: 3 }, // "marcos3"
        { name: "Cadu",   p: 1 },
        { name: "Jerfeson",   p: 1 },
      ],
      qui: [
        { name: "Cadu",   p: 5 },
        { name: "Anthony",    p: 5 },
        { name: "Lucas Solerne",  p: 4 },
        { name: "Paulo",  p: 3 },
        { name: "Yan Lucas",    p: 3 },
        { name: "Marcos", p: 2 }, // "marcos2"
        { name: "Pedro",  p: 1 },
        { name: "Natasha",   p: 1 },
      ],
    };
    const DIA_LABEL = { dom: "Domingo", seg: "Segunda", ter: "Terça", quar: "Quarta", qui: "Quinta" };
    const DIA_KEY_BY_NUM = { 0: "dom", 1: "seg", 2: "ter", 3: "quar", 4: "qui", 5: "dom", 6: "dom" };
    const MAX_POR_COLAB = 2;

    // ======= UI =======
    const selDia = document.getElementById("dia");
    const inpQtd = document.getElementById("qtd");
    const btnGerar = document.getElementById("gerar");
    const btnLimpar = document.getElementById("limpar");
    const btnCopiar = document.getElementById("copiar");
    const caps = document.getElementById("caps");
    const alerta = document.getElementById("alerta");
    const tabela = document.getElementById("tabela");
    const tbody = tabela.querySelector("tbody");
    const priorList = document.getElementById("prior-list");

    // Preenche select
    (function init() {
      Object.keys(PRIORIDADES).forEach(k => {
        const opt = document.createElement("option");
        opt.value = k;
        opt.textContent = DIA_LABEL[k] || k;
        selDia.appendChild(opt);
      });
      // Define o valor padrão de acordo com o dia atual (sex/sáb → domingo)
      const hojeNum = new Date().getDay();
      selDia.value = DIA_KEY_BY_NUM[hojeNum] || "dom";
      refreshDayInfo();
    })();

    selDia.addEventListener("change", refreshDayInfo);
    btnGerar.addEventListener("click", handleGerar);
    btnLimpar.addEventListener("click", limpar);
    btnCopiar.addEventListener("click", copiarResultado);

    function refreshDayInfo() {
      const key = selDia.value;
      const lista = PRIORIDADES[key] || [];
      const capacidadeTotal = lista.length * MAX_POR_COLAB;
      const top = Math.max(...lista.map(x => x.p));
      const topNomes = lista.filter(x => x.p === top).map(x => x.name);
      // Caps
      caps.innerHTML = `
        <span>Dia: <strong>${DIA_LABEL[key] || key}</strong></span>
        <span>Colaboradores: <strong>${lista.length}</strong></span>
        <span>Capacidade Total: <strong>${capacidadeTotal}</strong> (até ${MAX_POR_COLAB} por pessoa)</span>
        <span>Maior prioridade: <strong>${top}</strong> (${topNomes.join(", ")})</span>
      `;
      // Prioridades visíveis
      renderPrioridades(key);
      // Mensagens
      alerta.innerHTML = "";
      tabela.style.display = "none";
      tbody.innerHTML = "";
    }

    function renderPrioridades(key) {
      const lista = [...(PRIORIDADES[key] || [])].sort((a,b) => b.p - a.p || a.name.localeCompare(b.name));
      const half = Math.ceil(lista.length/2);
      const col1 = lista.slice(0, half);
      const col2 = lista.slice(half);

      function renderCol(arr) {
        return `
          <div>
            ${arr.map(x => `
              <div style="display:flex;justify-content:space-between;gap:8px;padding:6px 8px;margin-bottom:6px;border:1px solid var(--border);border-radius:8px;">
                <span>${x.name}</span>
                <span class="pill">prio ${x.p}</span>
              </div>
            `).join("")}
          </div>
        `;
      }
      priorList.innerHTML = renderCol(col1) + renderCol(col2);
    }

    function handleGerar() {
      const key = selDia.value;
      const qtd = Math.max(1, parseInt(inpQtd.value || "1", 10));
      const lista = PRIORIDADES[key] || [];

      if (!lista.length) {
        showMsg("Nenhum colaborador cadastrado para este dia.", "err");
        return;
      }

      const capacidadeTotal = lista.length * MAX_POR_COLAB;
      if (qtd > capacidadeTotal) {
        showMsg(`Capacidade insuficiente: capacidade do dia é ${capacidadeTotal} e você pediu ${qtd}. Atribuirei ${capacidadeTotal} e ${qtd - capacidadeTotal} ficarão sem responsável.`, "warn");
      } else {
        showMsg(`Tudo certo! Capacidade do dia: ${capacidadeTotal}.`, "ok");
      }

      const result = atribuir(lista, Math.min(qtd, capacidadeTotal));
      renderTabela(result);
    }

    function atribuir(lista, qtd) {
      // Contagem por colaborador
      const cont = Object.create(null);
      for (const p of lista) cont[p.name] = 0;

      const res = [];
      while (res.length < qtd) {
        // Elegíveis (ainda com capacidade)
        const elegiveis = lista.filter(p => cont[p.name] < MAX_POR_COLAB);
        if (!elegiveis.length) break;

        // Maior prioridade disponível
        const maxP = Math.max(...elegiveis.map(x => x.p));
        const top = elegiveis.filter(x => x.p === maxP);

        // Sorteio entre os de maior prioridade
        const escolhido = top[Math.floor(Math.random() * top.length)];

        // Ao escolher um colaborador, aloca até 2 clientes consecutivos para ele
        // (ou até o limite que falta para o colaborador ou o restante de qtd)
        const restanteParaColab = MAX_POR_COLAB - cont[escolhido.name];
        const restanteTotal = qtd - res.length;
        const alocar = Math.min(2, restanteParaColab, restanteTotal);

        for (let i = 0; i < alocar; i++) {
          cont[escolhido.name] += 1;
          res.push({
            idx: res.length + 1,
            name: escolhido.name,
            p: escolhido.p,
            carga: cont[escolhido.name],
          });
        }
      }
      return res;
    }

    function renderTabela(res) {
      tbody.innerHTML = res.map(r => `
        <tr>
          <td>${r.idx}</td>
          <td>${r.name}</td>
          <td><span class="pill">prio ${r.p}</span></td>
          <td>${r.carga} / ${MAX_POR_COLAB}</td>
        </tr>
      `).join("");
      tabela.style.display = res.length ? "table" : "none";
    }

    function showMsg(text, kind) {
      alerta.innerHTML = `<div class="msg ${kind}">${text}</div>`;
    }

    function limpar() {
      alerta.innerHTML = "";
      tbody.innerHTML = "";
      tabela.style.display = "none";
    }

    function copiarResultado() {
      if (!tbody.children.length) {
        showMsg("Nada para copiar ainda. Gere uma atribuição primeiro.", "warn");
        return;
      }
      const linhas = Array.from(tbody.children).map(tr => {
        const tds = tr.querySelectorAll("td");
        const num = tds[0].textContent.trim();
        const nome = tds[1].textContent.trim();
        const prio = tds[2].innerText.replace(/\s+/g, " ").trim(); // e.g. "prio 5"
        const carga = tds[3].textContent.trim();
        return `Cliente ${num}: ${nome} (${prio}) — carga ${carga}`;
      });
      const texto = linhas.join("\n");
      navigator.clipboard.writeText(texto).then(
        () => showMsg("Resultado copiado para a área de transferência!", "ok"),
        () => showMsg("Não consegui copiar automaticamente. Selecione e copie manualmente.", "warn")
      );
    }
  </script>
</body>
</html>
